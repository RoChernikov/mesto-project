(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{W:()=>g});var t=document.querySelector(".popup-confirm"),n=document.querySelector(".page"),r=document.querySelector(".popup-photo"),o=r.querySelector(".popup-photo__image"),c=r.querySelector(".popup-photo__figcaption"),a=function(e){e.querySelector(".popup__container").classList.add("popup__container_opened"),e.classList.add("popup_opened"),n.classList.add("page_hold"),document.addEventListener("keydown",u)},i=function(e){(e.target.classList.contains("popup")||e.target.classList.contains("popup__close-btn"))&&v(e)},s=function(e){e.querySelector(".popup__container").classList.remove("popup__container_opened"),e.classList.remove("popup_opened"),n.classList.remove("page_hold"),document.removeEventListener("keydown",u)};function u(e){"Escape"===e.key&&(s(document.querySelector(".popup_opened")),v(e))}var l={baseUrl:"https://nomoreparties.co/v1/plus-cohort-2/",headers:{authorization:"97ccf1bd-d259-459d-8352-7ffe6d750b35","Content-Type":"application/json"}},d=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status," - ").concat(e.statusText))},f=document.querySelector(".cards__list"),_=function(e,t){return e.textContent=t.likes.length},p=function(e,t,n){0==+n.textContent?function(e){setTimeout((function(){e.classList.add("cards__like-counter_active")}),200)}(n):1==+n.textContent&&t.classList.contains("cards__like-btn_active")&&function(e){e.classList.remove("cards__like-counter_active")}(n),function(e,t,n){t.classList.contains("cards__like-btn_active")?function(e,t,n){(function(e){return fetch("".concat(l.baseUrl,"cards/likes/").concat(e),{method:"DELETE",headers:l.headers}).then((function(e){return d(e)}))})(e).then((function(e){t.classList.remove("cards__like-btn_active"),_(n,e)})).catch((function(e){console.log(e)}))}(e,t,n):function(e,t,n){(function(e){return fetch("".concat(l.baseUrl,"cards/likes/").concat(e),{method:"PUT",headers:l.headers}).then((function(e){return d(e)}))})(e).then((function(e){t.classList.add("cards__like-btn_active"),_(n,e)})).catch((function(e){console.log(e)}))}(e,t,n)}(e,t,n)},m=function e(){var n=document.querySelector(".delete-target"),r=n.id;t.removeEventListener("submit",e),function(e){return fetch("".concat(l.baseUrl,"cards/").concat(e),{method:"DELETE",headers:l.headers}).then((function(e){return d(e)}))}(r).then((function(){n.remove(),s(t)})).catch((function(e){console.log(e)}))},v=function(e){var n=document.querySelector(".delete-target");n&&(t.removeEventListener("submit",m),t.removeEventListener("click",i),n.classList.remove("delete-target"))},y=function(e){f.prepend(function(e){var n,s,u,l=document.querySelector("#card-template").content.querySelector(".cards__item").cloneNode(!0),d=l.querySelector(".cards__image"),f=l.querySelector(".cards__heading"),_=l.querySelector(".cards__like-btn"),v=l.querySelector(".cards__like-counter"),y=l.querySelector(".cards__trash-btn"),h=l.querySelector(".cards__spinner");return e.likes,l.id="".concat(e._id),d.src="".concat(e.link),d.alt="".concat(e.name),f.textContent="".concat(e.name),v.textContent=e.likes.length,y.addEventListener("click",(function(e){!function(e){e.target.closest(".cards__item").classList.add("delete-target")}(e),a(t),t.addEventListener("submit",m),t.addEventListener("click",i)})),d.addEventListener("click",(function(){return function(e){o.src="".concat(e.link),o.alt="".concat(e.name),c.textContent="".concat(e.name),a(r)}(e)})),_.addEventListener("click",(function(){return p(e._id,_,v)})),function(e,t){e._id===g&&t.classList.add("cards__trash-btn_visible")}(e.owner,y),S(d,h,"cards__image_error"),n=e.likes,s=_,u=v,n.length>0&&u.classList.add("cards__like-counter_active"),n.some((function(e){return e._id===g}))&&s.classList.toggle("cards__like-btn_active"),l}(e))},h=function(e,t,n){e.value=t?"Сохранение...":n},b=function(e,t){e.classList.add(t),e.setAttribute("disabled","disabled")};function S(e,t,n){(function(e,t){return new Promise((function(n,r){t.classList.add("spinner_visible"),e.onerror=r,e.onload=n}))})(e,t).then((function(){t.classList.remove("spinner_visible")})).catch((function(){t.classList.remove("spinner_visible"),e.classList.add(n)}))}var L=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?function(e,t){e.classList.remove(t),e.removeAttribute("disabled","disabled")}(t,n.inactiveButtonClass):b(t,n.inactiveButtonClass)},q={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__submit",inactiveButtonClass:"form__submit_disabled",inputErrorClass:"form__input_invalid",errorClass:"form__input-error_active"},g=null,k=document.querySelector(".profile"),E=k.querySelector(".profile__name"),C=k.querySelector(".profile__about"),x=k.querySelector(".profile__avatar"),A=k.querySelector(".profile__spinner"),T=document.querySelector(".popup-edit"),U=T.querySelector(".form__input_type_name"),P=T.querySelector(".form__input_type_about"),B=T.querySelector(".form"),O=T.querySelector(".form__submit"),j=document.querySelector(".popup-avatar"),w=j.querySelector(".form"),N=document.querySelector(".form__input_type_avatar-link"),D=j.querySelector(".form__submit"),J=document.querySelector(".popup-add"),H=J.querySelector(".form"),z=J.querySelector(".form__submit"),M=J.querySelector(".form__input_type_img-title"),W=J.querySelector(".form__input_type_img-link"),F=Array.from(document.querySelectorAll(".popup")),G=function(e,t){E.textContent=e,C.textContent=t};Promise.all([fetch("".concat(l.baseUrl,"users/me"),{headers:l.headers}).then((function(e){return d(e)})),fetch("".concat(l.baseUrl,"cards"),{headers:l.headers}).then((function(e){return d(e)}))]).then((function(e){g=e[0]._id,G(e[0].name,e[0].about),x.setAttribute("src","".concat(e[0].avatar)),e[1].reverse().forEach((function(e){y(e)}))})).catch((function(e){return console.log(e)})),document.querySelector(".page-btn_type_edit").addEventListener("click",(function(){U.value=E.textContent,P.value=C.textContent,a(T)})),document.querySelector(".profile__avatar-container").addEventListener("click",(function(){return a(j)})),document.querySelector(".page-btn_type_add").addEventListener("click",(function(){return a(J)})),B.addEventListener("submit",(function(){var e={name:"".concat(U.value),about:"".concat(P.value)};h(O,!0),function(e){return fetch("".concat(l.baseUrl,"users/me"),{method:"PATCH",headers:l.headers,body:JSON.stringify({name:e.name,about:e.about})}).then((function(e){return d(e)}))}(e).then((function(e){G(e.name,e.about),s(T)})).catch((function(e){console.log(e)})).finally((function(){return h(O,!1,"Сохранить")}))})),j.addEventListener("submit",(function(){var e=N.value;h(D,!0),S(x,A,"profile__avatar_error"),function(e){return fetch("".concat(l.baseUrl,"users/me/avatar"),{method:"PATCH",headers:l.headers,body:JSON.stringify({avatar:"".concat(e)})}).then((function(e){return d(e)}))}(e).then((function(e){x.setAttribute("src",e.avatar),b(D,q.inactiveButtonClass),s(j),w.reset()})).catch((function(e){console.log(e)})).finally((function(){return h(D,!1,"Сохранить")}))})),H.addEventListener("submit",(function(){var e,t={name:M.value,link:W.value};h(z,!0),(e=t,fetch("".concat(l.baseUrl,"cards"),{method:"POST",headers:l.headers,body:JSON.stringify({name:e.name,link:e.link})}).then((function(e){return d(e)}))).then((function(e){y(e),b(z,q.inactiveButtonClass),s(J),H.reset()})).catch((function(e){console.log(e)})).finally((function(){return h(z,!1,"Создать")}))})),function(e){Array.from(document.querySelectorAll("".concat(e.formSelector))).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""}(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(e,t,t.validationMessage,n)}(e,o,t),L(n,r,t)})),L(n,r,t)}))}(t,e)}))}(q),F.forEach((function(e){e.addEventListener("click",(function(e){(e.target.classList.contains("popup")||e.target.classList.contains("popup__close-btn"))&&s(e.target.closest(".popup"))}))})),S(x,A,"profile__avatar_error"),setTimeout((function(){return function(e){return e.forEach((function(e){return e.style.display="flex"}))}(F)}),100)})();