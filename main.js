(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{W:()=>y});var t=document.querySelector(".page"),n=document.querySelector(".popup-confirm"),o=function(e){e.querySelector(".popup__container").classList.add("popup__container_opened"),e.classList.add("popup_opened"),t.classList.add("page_hold"),document.addEventListener("keydown",a)},r=function(e){n.addEventListener("submit",(function(){d(e),c(n)})),o(n)},c=function(e){e.querySelector(".popup__container").classList.remove("popup__container_opened"),e.classList.remove("popup_opened"),t.classList.remove("page_hold"),document.removeEventListener("keydown",a)};function a(e){"Escape"===e.key&&c(document.querySelector(".popup_opened"))}var i={baseUrl:"https://nomoreparties.co/v1/plus-cohort-2/",headers:{authorization:"97ccf1bd-d259-459d-8352-7ffe6d750b35","Content-Type":"application/json"}},s=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status," - ").concat(e.statusText))},u=function(){return fetch("".concat(i.baseUrl,"users/me"),{headers:i.headers}).then((function(e){return s(e)}))},l=function(e,t,n){0==+n.textContent?function(e){e.classList.add("cards__like-counter_active")}(n):1==+n.textContent&&t.classList.contains("cards__like-btn_active")&&function(e){e.classList.remove("cards__like-counter_active")}(n),function(e,t,n){t.classList.contains("cards__like-btn_active")?function(e,t,n){(function(e){return fetch("".concat(i.baseUrl,"cards/likes/").concat(e),{method:"DELETE",headers:i.headers}).then((function(e){return s(e)}))})(e).then((function(){t.classList.remove("cards__like-btn_active")})).catch((function(e){console.log(e)})),n.textContent=+n.textContent-1}(e,t,n):function(e,t,n){(function(e){return fetch("".concat(i.baseUrl,"cards/likes/").concat(e),{method:"PUT",headers:i.headers}).then((function(e){return s(e)}))})(e).then((function(){t.classList.add("cards__like-btn_active")})).catch((function(e){console.log(e)})),n.textContent=+n.textContent+1}(e,t,n)}(e,t,n)},d=function(e){var t,n=e.target.closest(".cards__item");n.remove(),t=n.id,fetch("".concat(i.baseUrl,"cards/").concat(t),{method:"DELETE",headers:i.headers}).then((function(e){return s(e)}))};function f(e){document.querySelector(".cards__list").prepend(function(e){var t,n,c,a=document.querySelector("#card-template").content.querySelector(".cards__item").cloneNode(!0),i=a.querySelector(".cards__image"),s=a.querySelector(".cards__heading"),u=a.querySelector(".cards__like-btn"),d=a.querySelector(".cards__like-counter"),f=a.querySelector(".cards__trash-btn"),_=a.querySelector(".cards__spinner");return e.likes,a.id="".concat(e._id),i.src="".concat(e.link),i.alt="".concat(e.name),s.textContent="".concat(e.name),d.textContent=e.likes.length,f.addEventListener("click",r),i.addEventListener("click",(function(){return function(e){var t=document.querySelector(".popup-photo"),n=t.querySelector(".popup-photo__image"),r=t.querySelector(".popup-photo__figcaption");n.src="".concat(e.link),n.alt="".concat(e.name),r.textContent="".concat(e.name),o(t)}(e)})),u.addEventListener("click",(function(){return l(e._id,u,d)})),function(e,t){e._id===y&&t.classList.add("cards__trash-btn_visible")}(e.owner,f),m(i,_,"cards__image_error"),t=e.likes,n=u,c=d,t.length>0&&c.classList.add("cards__like-counter_active"),t.some((function(e){return e._id===y}))&&n.classList.toggle("cards__like-btn_active"),a}(e))}var _=function(e,t){t?e.value="Сохранение...":e.classList.contains("form__submit_type_add")?e.value="Создать":e.value="Сохранить"},p=function(e,t){e.classList.add(t),e.setAttribute("disabled","disabled")};function m(e,t,n){(function(e,t){return new Promise((function(n,o){t.classList.add("spinner_visible"),e.onerror=o,e.onload=n}))})(e,t).then((function(){t.classList.remove("spinner_visible")})).catch((function(){t.classList.remove("spinner_visible"),e.classList.add(n)}))}var v=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?function(e,t){e.classList.remove(t),e.removeAttribute("disabled","disabled")}(t,n.inactiveButtonClass):p(t,n.inactiveButtonClass)},h={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__submit",inactiveButtonClass:"form__submit_disabled",inputErrorClass:"form__input_invalid",errorClass:"form__input-error_active"},y=null,b=document.querySelector(".profile"),S=b.querySelector(".profile__name"),q=b.querySelector(".profile__about"),L=b.querySelector(".profile__avatar"),g=b.querySelector(".profile__spinner"),k=document.querySelector(".popup-edit"),E=k.querySelector(".form__input_type_name"),C=k.querySelector(".form__input_type_about"),x=k.querySelector(".form"),A=k.querySelector(".form__submit"),U=document.querySelector(".popup-avatar"),T=U.querySelector(".form"),P=document.querySelector(".form__input_type_avatar-link"),B=U.querySelector(".form__submit"),O=document.querySelector(".popup-add"),j=O.querySelector(".form"),w=O.querySelector(".form__submit"),N=O.querySelector(".form__input_type_img-title"),D=O.querySelector(".form__input_type_img-link"),J=Array.from(document.querySelectorAll(".popup")),H=function(){u().then((function(e){y=e._id,S.textContent=e.name,q.textContent=e.about})).catch((function(e){console.log(e)}))},z=function(){u().then((function(e){L.setAttribute("src","".concat(e.avatar))})).catch((function(e){console.log(e)}))};document.querySelector(".page-btn_type_edit").addEventListener("click",(function(){E.value=S.textContent,C.value=q.textContent,o(k)})),document.querySelector(".profile__avatar-container").addEventListener("click",(function(){return o(U)})),document.querySelector(".page-btn_type_add").addEventListener("click",(function(){return o(O)})),x.addEventListener("submit",(function(){var e={name:"".concat(E.value),about:"".concat(C.value)};_(A,!0),function(e){return fetch("".concat(i.baseUrl,"users/me"),{method:"PATCH",headers:i.headers,body:JSON.stringify({name:e.name,about:e.about})}).then((function(e){return s(e)}))}(e).then((function(){return H()})).catch((function(e){console.log(e)})).finally((function(){c(k),_(A,!1)}))})),U.addEventListener("submit",(function(){var e=P.value;_(B,!0),m(L,g,"profile__avatar_error"),function(e){return fetch("".concat(i.baseUrl,"users/me/avatar"),{method:"PATCH",headers:i.headers,body:JSON.stringify({avatar:"".concat(e)})}).then((function(e){s(e)}))}(e).then((function(){z()})).catch((function(e){console.log(e)})).finally((function(){p(B,h.inactiveButtonClass),_(B,!1),c(U),T.reset()}))})),j.addEventListener("submit",(function(){var e,t={name:N.value,link:D.value};_(w,!0),(e=t,fetch("".concat(i.baseUrl,"cards"),{method:"POST",headers:i.headers,body:JSON.stringify({name:e.name,link:e.link})}).then((function(e){return s(e)}))).then((function(e){f(e)})).catch((function(e){console.log(e)})).finally((function(){p(w,h.inactiveButtonClass),_(w,!1),c(O),j.reset()}))})),function(e){Array.from(document.querySelectorAll("".concat(e.formSelector))).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,r,t),v(n,o,t)})),v(n,o,t)}))}(t,e)}))}(h),J.forEach((function(e){e.addEventListener("click",(function(e){(e.target.classList.contains("popup")||e.target.classList.contains("popup__close-btn"))&&c(e.target.closest(".popup"))}))})),m(L,g,"profile__avatar_error"),H(),z(),u().then((function(e){fetch("".concat(i.baseUrl,"cards"),{headers:i.headers}).then((function(e){return s(e)})).then((function(e){e.reverse().forEach((function(e){f(e)}))}))})).catch((function(e){console.log(e)})),setTimeout((function(){return function(e){return e.forEach((function(e){return e.style.display="flex"}))}(J)}),100)})();